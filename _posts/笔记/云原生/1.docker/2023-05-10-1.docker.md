---
title: 1.0 docker
date: 2023-05-10
categories: [笔记, '云原生', 'docker']
tags: [云原生]
---

## Docker


### 1.Docker是什么
     1. 基于 Linux 内核的 Cgroup，Namespace，以及 Union FS 等技术，对进程进行封装隔离，属于操作系统 层面的虚拟化技术，由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器。
     2. 最初实现是基于 LXC，从 0.7 以后开始去除 LXC，转而使用自行开发的 Libcontainer，从 1.11 开始，则 进一步演进为使用 runC 和 Containerd。
     3. Docker 在容器的基础上，进行了进一步的封装，从文件系统、网络互联到进程隔离等等，极大的简化了容 器的创建和维护，使得 Docker 技术比虚拟机技术更为轻便、快捷。

---
### 2.why Docker?

#### docker优点
```
• 更高效地利用系统资源 
• 更快速的启动时间
• 一致的运行环境
• 持续交付和部署
• 更轻松地迁移
• 更轻松地维护和扩展


>优势 

封装性:
  • 不需要再启动内核，所以应用扩缩容时可以秒速启动。
  • 资源利用率高，直接使用宿主机内核调度资源，性能损失小。
  • 方便的 CPU、内存资源调整。
  • 能实现秒级快速回滚。
  • 一键启动所有依赖服务，测试不用为搭建环境犯愁，PE 也不用为 建站复杂担心。
  • 镜像一次编译，随处使用。
  • 测试、生产环境高度一致(数据除外)。
隔离性:
  • 应用的运行环境和宿主机环境无关，完全由镜像控制，一台物理 机上部署多种环境的镜像测试。
  • 多个应用版本可以并存在机器上。
镜像增量分发:
  • 由于采用了 Union FS， 简单来说就是支持将不同的目录 挂载到同一个虚拟文件系统下，并实现一种 layer 的概 念，每次发布只传输变化的部分，节约带宽。社区活跃:
  • Docker 命令简单、易用，社区十分活跃，且周边组件丰富。
```

#### 虚拟机和容器对比
运行态对比
![运行态的对比](/commons/云原生/docker/image/docker%20vm.jpg)

性能对比
![性能对比](/commons/云原生/docker/image/docker%20vm2.png)

---

### 3.容器特性
• 安全性 • 隔离性 • 可配额 • 便携性

---

### 4.容器标准
• Open Container Initiative(OCI)  - 轻量级开放式管理组织(项目)
 * OCI 主要定义两个规范
    * Runtime Specification - 文件系统包如何解压至硬盘，共运行时运行。
    * Image Specification - 如何通过构建系统打包，生成镜像清单(Manifest)、文件系统序列化文件、镜像配置。

---

### 5.Dockerfile 最佳实践
- 不要安装无效软件包。
- 应简化镜像中同时运行的进程数，理想状况下，每个镜像应该只有一个进程。
- 当无法避免同一镜像运行多进程时，应选择合理的初始化进程(init process)。
- 最小化层级数
- 最新的 docker 只有 RUN， COPY，ADD 创建新层，其他指令创建临时层，不会增加镜像大小。 • 比如 EXPOSE 指令就不会生成新层。
- 多条 RUN 命令可通过连接符连接成一条指令集以减少层数。
- 通过多段构建减少镜像层数。
- 把多行参数按字母排序，可以减少可能出现的重复参数，并且提高可读性。
- 编写 dockerfile 的时候，应该把变更频率低的编译指令优先构建以便放在镜像底层以有效利用 build cache。
- 复制文件时，每个文件应独立复制，这确保某个文件变更时，只影响改文件对应的缓存。
- 确保构建上下文清晰
目标:易管理、少漏洞、镜像小、层级少、利用缓存。

---

### 6.扩展阅读
* [可配额-Cgroup](1.2docker-cgroup.md)
* [隔离性-Namespace](1.1docker-namespace.md)
* [Union FS](1.3docker-unionFS.md)
* [网络](1.4docker-net.md)
