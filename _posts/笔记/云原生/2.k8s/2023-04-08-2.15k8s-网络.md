---
title: 2.15 k8s-网络
date: 2023-04-08
categories: [笔记, '云原生', 'k8s']
tags: [云原生]
---

# 网络

## 一些概念

### GTM
GTM是全局负载均衡器（Global Traffic Manager）的缩写，是一种通过智能DNS解析来实现全球负载均衡的技术。GTM会将用户请求路由到最近、最佳的服务器上，以提高网站的可用性和性能。它可以根据用户的地理位置、网络延迟、服务器负载等因素来选择服务器，从而确保用户的请求得到最快速、最可靠的响应。

### uDNS
uDNS是微软开发的一种专用的DNS解析服务，它提供了一种快速且可扩展的DNS解析方案，可以处理高达数千万的DNS查询请求。与传统的DNS服务器相比，uDNS具有更高的性能、更强的可靠性和更好的安全性，因此被广泛应用于云计算和大规模网络环境中。uDNS还支持IPv6和DNSSEC等新型协议和安全机制，可以为网络安全提供更好的保障。

### Web层负载均衡器 和 应用层负载均衡器

Web层负载均衡器（Web Layer Load Balancer）和应用层负载均衡器（Application Layer Load Balancer）都是负载均衡器的一种，但是它们所处的位置和所提供的功能不同。

Web层负载均衡器位于网络架构中的前端，主要负责将客户端请求（例如HTTP或HTTPS请求）分发到多个Web服务器上，以达到均衡负载和提高可用性的目的。Web层负载均衡器通常能够识别和处理HTTP请求，并根据请求的内容（如URL、HTTP头等）来选择最佳的服务器。

应用层负载均衡器则更加高级，它可以深入应用程序层面，根据应用层协议（如SMTP、FTP、DNS等）来进行负载均衡，以实现更细粒度的流量控制和智能路由。应用层负载均衡器还可以进行会话保持（Session Persistence）和应用层协议转换等功能，以确保客户端的请求得到正确的处理。

区分Web层负载均衡器和应用层负载均衡器的主要原因是它们所处的位置和所提供的功能不同。Web层负载均衡器通常是负载均衡的第一层，直接面向用户，主要解决Web服务器的负载均衡和可用性问题；应用层负载均衡器则更加高级，面向的是应用程序，主要解决复杂的应用负载均衡和流量控制问题。通过区分不同层次的负载均衡器，可以为网络架构提供更加灵活、可扩展和高效的负载均衡解决方案。

通过采用多层负载均衡器，网络架构可以更加灵活、可扩展和高效。例如，在高流量的Web应用程序中，可以使用Web层负载均衡器进行基本的负载均衡和可用性处理，然后再使用应用层负载均衡器进行更细粒度的流量控制和智能路由。这种多层负载均衡的方式可以提高应用程序的性能和可用性，并为应用程序架构提供更好的扩展性和灵活性。
比如: 在web层切1%流量到其他region,  当前 region 异常时 流量可以从 web 层都切到其他 region

### MTBB
MTBB（Mean Time Between Bad Behavior）是一种网络性能指标，用于衡量网络设备或服务的故障率。它通常是指在设备或服务正常运行的情况下，出现故障的平均时间间隔。

与 MTBF（Mean Time Between Failures，平均故障间隔时间）相比，MTBB 更加细化和全面，因为它不仅考虑设备或服务的硬件故障，还考虑了软件异常、网络延迟、服务中断等多种因素。

MTBB 的计算方法通常是在一定时间范围内，记录设备或服务出现异常或不良行为的次数和持续时间，然后计算平均时间间隔。例如，如果在一天内，某个网络设备出现了 2 次故障，分别持续了 10 分钟和 20 分钟，则 MTBB 可以计算为：

MTBB = (24 × 60) / (2 × 15) = 480 / 2 = 240 分钟

这意味着该设备在正常运行状态下，平均每 240 分钟就会出现一次故障或不良行为。

MTBB 对于网络运维和性能管理非常重要，因为它可以帮助网络管理员和运维人员了解设备或服务的稳定性和可靠性，并及时采取措施预防故障和提高服务水平。

### k8s providor
在 Kubernetes 中，Provider 是指实现 Kubernetes API 接口和扩展的实体，可以与 Kubernetes 集群进行交互，例如管理容器、存储、网络等资源。

Kubernetes Provider 是指提供了与 Kubernetes 集群交互的功能，以便在 Kubernetes 中使用特定的云服务或基础设施。 Kubernetes 提供了许多不同的云提供商 Provider，包括 Amazon Web Services (AWS)、Google Cloud Platform (GCP)、Microsoft Azure、IBM Cloud 等等。这些 Provider 提供了对应云提供商的 API 调用，以便将 Kubernetes 集群与云基础设施进行集成和管理。

Provider 通常包含以下组件：

Controller Manager：用于管理集群中的资源对象，例如节点、Pod、Service、Replication Controller 等。

Scheduler：用于调度 Pod 到 Kubernetes 集群中的节点。

Cloud Controller Manager：用于与云提供商 API 进行交互，以管理云基础设施中的资源，例如虚拟机、负载均衡器、存储等。

Volume Plugin：用于与云提供商的存储系统进行交互，以提供动态卷的支持。

使用 Kubernetes Provider 可以方便地在 Kubernetes 集群中管理云基础设施，例如自动创建和管理云资源、自动调整容器的数量和大小、自动扩展负载均衡器等，从而提高应用程序的可用性和可扩展性。



## 传统网络拓扑
![2.15(1).png](/commons/云原生/docker/image/2.15(1).png)

## k8s网络拓扑
![2.15(9).png](/commons/云原生/docker/image/2.15(9).png)

* 跨数据中心LB-> 避免DNS缓存ttl问题, 可以快速切流量
* 本地LB -> 屏蔽下面pod频繁变化, 避免跨数据中心LB配置过于复杂

## 自建 SLB 网络拓扑
### 架构
![](/commons/云原生/docker/image/2.15(2).png)
![](/commons/云原生/docker/image/2.15(3).png)

### 数据流
![](/commons/云原生/docker/image/2.15(4).png)
## 边缘加速
### 当前问题
![](/commons/云原生/docker/image/2.15(5).png)
### 边缘加速方案
![](/commons/云原生/docker/image/2.15(6).png)
![](/commons/云原生/docker/image/2.15(7).png)
![](/commons/云原生/docker/image/2.15(8).png)


