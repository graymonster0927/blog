---
title: 1-API 设计
date: 2022-11-9
categories: [笔记, '云原生', 'k8s其他']
tags: [云原生]
---


### 所有 API 都应是声明式的
* 相对于命令式操作，声明式操作对于重复操作的效果是稳定的，这对于容易出现数据丢失或重复的分布式环境来说是很重要的。
* 声明式操作更易被用户使用，可以使系统向用户隐藏实现的细节，同时也保留了系统未来持续优化的可能性。
* 此外，声明式的 API 还隐含了所有的 API 对象都是名词性质的，例如 Service、Volume 这些 API 都是名词，这些名词描述了用户所
期望得到的一个目标对象。
* API 对象是彼此互补而且可组合的
* 这实际上鼓励 API 对象尽量实现面向对象设计时的要求，即“高内聚，松耦合”，对业务相关的概念有一个合适的分解，提高分解出
来的对象的可重用性。
* 高层 API 以操作意图为基础设计
* 如何能够设计好 API，跟如何能用面向对象的方法设计好应用系统有相通的地方，高层设计一定是从业务出发，而不是过早的从技术
实现出发。
* 因此，针对 Kubernetes 的高层 API 设计，一定是以 Kubernetes 的业务为基础出发，也就是以系统调度管理容器的操作意图为基础 设计。

### API 设计原则
* 低层API根据高层API的控制需要设计
* 设计实现低层 API 的目的，是为了被高层 API 使用，考虑减少冗余、提高重用性的目的，低层 API
的设计也要以需求为基础，要尽量抵抗受技术实现影响的诱惑。
* 尽量避免简单封装，不要有在外部API无法显式知道的内部隐藏的机制
* 简单的封装，实际没有提供新的功能，反而增加了对所封装 API 的依赖性。
* 例如 StatefulSet 和 ReplicaSet，本来就是两种 Pod 集合，那么 Kubernetes 就用不同 API 对象 来定义它们，而不会说只用同一个 ReplicaSet，内部通过特殊的算法再来区分这个 ReplicaSet 是 有状态的还是无状态。

### API 设计原则
* API操作复杂度与对象数量成正比
* API 的操作复杂度不能超过 O(N)，否则系统就不具备水平伸缩性了。
* API对象状态不能依赖于网络连接状态
* 由于众所周知，在分布式环境下，网络连接断开是经常发生的事情，因此要保证 API 对象状态能应
对网络的不稳定，API 对象的状态就不能依赖于网络连接状态。
* 尽量避免让操作机制依赖于全局状态
* 因为在分布式系统中要保证全局状态的同步是非常困难的。
